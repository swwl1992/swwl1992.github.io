<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width">
		<title>Ocaml React package tutorial</title>
		<link href="/css/syntax.css" type="text/css" rel="stylesheet">
		<link href="/css/style.css" type="text/css" rel="stylesheet">
		<link href="/img/favicon.ico" rel="icon">
	</head>
	<body>		
		<div id="main">
			<header>
				<div id="logo">
					<div id="logo_text">
					<a href="/"><h1>Salmon Blog</h1></a>
					<h2>Becoming sushi is not my destiny.</h2>
					</div>
				</div>
                <nav>
                    <div id="menu_container">
                        <ul id="nav" class="sf-menu">
                            <li><a href="/">Home</a></li>
                            <li><a href="http://apps.wanwenli.com">Salmon Apps</a></li>
                            <li><a href="/categories.html">Categories</a></li>
                            <li><a href="http://github.com/swwl1992">Me in Github</a></li>
                        </ul>
                    </div>
                </nav>
			</header>
			<div id="site_content">
				<div id="sidebar_container">
					<img class="paperclip" src="/images/paperclip.png" alt="paperclip"></img>
					<div class="sidebar">
						<h3>Links</h3>
						<ul>
							<li><a href="http://chenyuio.com">Chen Yu I/O</a></li>
							<li><a href="http://guanyilun.wordpress.com/author/guanyilun/">Yi Lun's Backyard</a></li>
							<li><a href="http://qiang.hu">A Hu Qiang Blog</a></li>
							<li><a href="http://joshuatj.com">JOSHUA.NG; I.AM.</a></li>
							<li><a href="http://onethingihaveasked.wordpress.com/">One thing I have asked</a></li>
						</ul>
					</div>
					<img class="paperclip" src="/images/paperclip.png" alt="paperclip"></img>
					<div class="sidebar">
						<h3>Latest update</h3>
						<h4>New website launched!</h4>
						<p>The entire CSS has been changed. Here is a cleaner format for you to read.</p>
					</div>
				</div>
				<div class="content"><h1>Ocaml React package tutorial</h1>
<b>28 Jan 2014</b>
<div id="article">
<p>React is an Ocaml package made for <a href="http://en.wikipedia.org/wiki/Reactive_programming">reactive programming</a>
using Ocaml.
The objective of this post is to illustrate and explain more regarding the React API.
Therefore the basic concepts of React, such as Signal, Events and side effects, will not be repeated here.
Below are some prerequisites for reading this post.</p>

<ul>
<li><a href="http://ocaml.org/">Ocaml</a> (version 4.00.1 or above)</li>
<li><a href="http://opam.ocamlpro.com/">OPAM</a> (Ocaml PAckage Manager)</li>
<li>React (installation via OPAM)</li>
<li><a href="http://erratique.ch/software/react/doc/React.html">React Introduction</a></li>
</ul>

<p>Most of the examples used in this post are inspired by
<a href="https://github.com/dbuenzli/react/blob/master/test/test.ml">test cases</a>
of React project.
To report an issue in the post,
contact me through my Github account.
Thank you for your feedbacks.</p>

<h3>Using React package</h3>

<p>For compilation</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">ocamlfind ocamlopt -o clock -linkpkg \
    -package react clock.ml
</code></pre></div>
<p>For Ocaml Toplevel</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">#use &quot;topfind&quot;;;
#require &quot;react&quot;;;
open React;;
</code></pre></div>
<h3>Module <a href="http://erratique.ch/software/react/doc/React.E.html">React.E</a></h3>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">once</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>once e is e with only its next occurence.
Any occurence after time t will not affect e.</p>

<div class="highlight"><pre><code class="ocaml"><span class="lineno">1</span> <span class="k">open</span> <span class="nc">React</span> <span class="c">(* omitted in the examples below *)</span>
<span class="lineno">2</span> <span class="k">let</span> <span class="n">w</span><span class="o">,</span> <span class="n">send_w</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>
<span class="lineno">3</span> <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">once</span> <span class="n">w</span>
<span class="lineno">4</span> <span class="k">let</span> <span class="n">pr_x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">map</span> <span class="n">print_int</span> <span class="n">x</span>
<span class="lineno">5</span> <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">send_w</span> <span class="o">[</span><span class="mi">0</span><span class="o">;</span> <span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">]</span>
</code></pre></div>

<p>The output would be only 0.
All the values after the first occurence are omitted.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">drop_once</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>drop_once e is e without its next occurrence.
Similarly, if we change the third line of the example above,
the output would be 123.
The reason is because the NEXT occurrence of e is omitted.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">app</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>app ef e occurs when both ef and e occur simultaneously.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">f</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">let</span> <span class="n">w</span><span class="o">,</span> <span class="n">send_w</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>
<span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">w</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">w</span><span class="o">)</span> <span class="n">w</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">drop_once</span> <span class="n">w</span>
<span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">app</span> <span class="n">x</span> <span class="n">y</span>
<span class="k">let</span> <span class="n">pr_z</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">map</span> <span class="n">print_int</span> <span class="n">z</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">send_w</span> <span class="o">[</span><span class="mi">0</span><span class="o">;</span> <span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">]</span>
</code></pre></div>

<p>The output would be 246.
As explained before,
drop_once makes y only take updates from the second occurrence onwards.
Variable z takes the value of x when both x and y are updated.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">map</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>map f e applies f to e&#39;s occurrences.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">stamp</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>stamp e v is map (fun _ -&gt; v) e.
It fixes the occurrence of e to v.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">filter</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>filter p e are e&#39;s occurrences that satisfy p.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">fmap</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="n">option</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>fmap fm e are occurrences of e filtered and mapped by fm. </p>

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">v</span><span class="o">,</span> <span class="n">send_v</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>
<span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">stamp</span> <span class="n">v</span> <span class="mi">1</span> <span class="c">(* x: 1111 *)</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="ow">mod</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">v</span> <span class="c">(* y: 02 *)</span>
<span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">fmap</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nc">Some</span> <span class="mi">1</span> <span class="k">else</span> <span class="nc">None</span><span class="o">)</span> <span class="n">v</span> <span class="c">(* z: 1 *)</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">send_v</span> <span class="o">[</span><span class="mi">0</span><span class="o">;</span> <span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">]</span>
</code></pre></div>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">diff</span> <span class="o">:</span> <span class="o">(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>diff f e occurs whenever e occurs except on the next occurence.
In another words,
it is triggered since the second the occurrence.
Occurences are f v v&#39; where v is e&#39;s current occurrence and v&#39; the previous one. </p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">changes</span> <span class="o">:</span> <span class="o">?</span><span class="n">eq</span><span class="o">:(</span><span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>changes eq e is the occurrences of e with occurences equal to the previous one dropped.
Equality is tested with eq (defaults to structural equality). 
The behavior is similar to Signals.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">x</span><span class="o">,</span> <span class="n">send_x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">diff</span> <span class="o">(</span> <span class="o">-</span> <span class="o">)</span> <span class="n">x</span>
<span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">changes</span> <span class="n">x</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">send_x</span> <span class="o">[</span><span class="mi">0</span><span class="o">;</span> <span class="mi">0</span><span class="o">;</span> <span class="mi">3</span><span class="o">;</span> <span class="mi">4</span><span class="o">;</span> <span class="mi">4</span><span class="o">]</span>
</code></pre></div>

<p>The occurrences of y are 0310 (difference between current and previous one),
while those of z are 034 (only changes are recorded).</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">dismiss</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>dismiss c e is the occurences of e except the ones when c occurs.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">x</span><span class="o">,</span> <span class="n">send_x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">fmap</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">mod</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nc">Some</span> <span class="n">x</span> <span class="k">else</span> <span class="nc">None</span><span class="o">)</span> <span class="n">x</span>
<span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">dismiss</span> <span class="n">y</span> <span class="n">x</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">send_x</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">;</span> <span class="mi">4</span><span class="o">;</span> <span class="mi">5</span><span class="o">;</span> <span class="mi">6</span><span class="o">]</span>
</code></pre></div>

<p>The occurrences of y are 246 (even numbers).
Occurrences of z are 135.
When y has occurrence, z will not have any occurrence.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">val</span> <span class="n">until</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">b</span> <span class="nn">React</span><span class="p">.</span><span class="n">event</span>
</code></pre></div>

<p>until c e is e&#39;s occurences until c occurs.</p>

<div class="highlight"><pre><code class="ocaml"><span class="k">let</span> <span class="n">x</span><span class="o">,</span> <span class="n">send_x</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>
<span class="k">let</span> <span class="n">stop</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="o">)</span> <span class="n">x</span>
<span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">until</span> <span class="n">stop</span> <span class="n">x</span>
<span class="k">let</span> <span class="n">pr_y</span> <span class="o">=</span> <span class="nn">E</span><span class="p">.</span><span class="n">map</span> <span class="n">print_string</span> <span class="n">y</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">send_x</span> <span class="o">[</span><span class="s2">&quot;a&quot;</span><span class="o">;</span> <span class="s2">&quot;b&quot;</span><span class="o">;</span> <span class="s2">&quot;c&quot;</span><span class="o">;</span> <span class="s2">&quot;d&quot;</span><span class="o">;</span> <span class="s2">&quot;e&quot;</span><span class="o">]</span>
</code></pre></div>

<p>The output is ab.
All the occurrences after stop event are dropped,
although stop has no more new updates.</p>

</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'wanwenli'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
			</div>				
		</div>
		<footer>
			<p>
                <a href="/">Home</a>
                &nbsp;|&nbsp;<a href="http://apps.wanwenli.com">Salmon Apps</a>
                &nbsp;|&nbsp;<a href="/categories.html">Categories</a>
                &nbsp;|&nbsp;<a href="http://github.com/swwl1992">Me in Github</a>
			</p>
			<p>Copyright &copy;  
			    <a rel="author" href="https://plus.google.com/104922911598414075400?rel=author">Simon Wan Wenli</a>
			&nbsp;2014
            &nbsp;| Design from <a href="http://www.css3templates.co.uk">css3templates.co.uk</a></p>
		</footer>
	</body>
</html>
